## Стилизация ExtJS-приложений


Документ актуален для Ext JS 5.1 и частично пересказывает [документацию](https://docs.sencha.com/extjs/5.1.3/guides/core_concepts/theming.html).

## Введение

Система стилизации в Ext JS построена на описании стилей на языке [Sass](http://sass-scss.ru/) и автоматической компиляции в Css.
Основой для стилизации в рамках фреймворка является **визуальная тема**. В комплекте с фреймворком уже поставляется несколько готовых тем:
 
 * Neptune и его мобильный собрат Neptune Touch
 * Crisp и Crisp Touch
 * Classic и Gray из мира Ext JS 4
 * ARIA (тема для людей с ограниченными возможностями)
 
Выбрав одну из тем за основу можно приступать к стилизации - по сути, созданию собственной темы.
Тема может быть как частью приложения (описываться в файлах директории sass уже имеющегося приложения), так и существовать отдельно в виде package-а.
В любом случае для сборки и разработки темы потребуется приложение, которое её будет использовать и на котором будет производиться тестирование темы.

* В случае "темизации" приложения работа начинается с определения базовой темы в файле app.json. К примеру: `"theme": "ext-theme-crisp"`.
* В случае создания новой темы потребуется создать заготовку темы, воспользовавшись командой `sencha generate theme имя-темы`. 
После генерации темы необходимо отредактировать файл package.json в директории `packages/имя-темы` и указать тему, от которой будем наследоваться. К примеру:`"extend": "ext-theme-neptune"`

Дальше оба подхода строятся на примерно одинаковых принципах.
После того, как генерация приложения или темы завершилась, можно перейти в директорию проекта или пакета, в которой будут следующие папки:

* **sass**: директория с исходными sass-файлами, содержащими описание стилей в текстовом представлении. Все файлы разложены по четырем папкам:
    * **sass/var** - переменные, которые будут использоваться в теме
    * **sass/src** - правила и миксины для описания внешнего вида компонент интерфейса. Могут использовать переменные из var
    * **sass/etc** - дополнительные правила и миксины, не привязанные к конкретным компонентам
    * **sass/example** - файлы, используемые при генерации изображений при "нарезке" спрайтов 
    для обратной совместимости с браузерами, не поддерживающими новые css-стандарты. 
    Мне эта директория ни разу не пригождалась, в гайдах просят её не удалять.
* **resources**: содержит изображения и другие статические ресурсы, используемые в теме
* **overrides**: хранит override-классы (JavaScript), изменяющие директивы и поведение классов Ext JS для целей стилизации.

Процесс работы над темой заключается в добавлении и изменении файлов в этих директориях. 
Для того, чтобы каждый раз после изменений не запускать процесс сборки css из sass, можно воспользоваться командой `sencha app watch`, запущенной из директории приложения, 
которая поднимет сервис-наблюдатель, отслеживающий изменения в файловой системе и автоматически пересобирающий css при изменении исходных файлов.
 
Даже если не было добавлено ни одного файла, при первом запуске `sencha app watch` соберет и положит в директорию 
`build/development/имяпроекта/resources` скомпилированную в набор css-файлов тему. В скомпилированном виде тема представляет из себя 
файл с "точкой входа" вида `имяпроекта-all.css` и набор файлов `имяпроекта-all_01.css`, `имяпроекта-all_02.css` и т.д. - данные файлы подключаются из основного css и содержат скомпилированные и минифицированные стили.    
Помимо этого, в JavaScript-исходники проекта в собранном виде также будут "включены" все override-классы из директории overrides темы.

## Разработка темы

Так как мы отнаследовались от уже существующей темы, при старте мы начинаем с приложения, использующего стили родительской темы. 
Перед нами может стоять три разных задачи:

1. Мы хотим стилизовать -- изменить цвет, размер, визуальное представление -- всех стандартных компонент Ext JS (все окна должны быть зелеными)
2. Мы хотим стилизовать некоторые экземпляры стандартных компонент Ext JS (все окна стандартного цвета, но одно конкретное окно должно быть зеленым)
3. Мы хотим создать новую компоненту и стилизовать её (мы в виде div-ов, span-ов и прочих html-тегов описали внутренности новой компоненты и хотим раскрасить их в зеленый) 

---

### Стилизовать все компоненты
Для этого нам потребуется собственная тема (`sencha generate theme`), отнаследованная от одной из стандартных.
Для осуществления задуманного нам необходимо переопределить переменные, которые использует Ext JS в своих темах.
Основные переменные описаны [в документации тут](http://docs.sencha.com/extjs/5.1.3/api/Global_CSS.html). К примеру, попробуем взять стандартное диалоговое окно
 
![1](https://github.com/kos33rd/documentation/raw/0431b981d091dd2cf2aa83a2ffe941d799f0fcf8/extjs-styling/1.png)
 
и увеличить радиус скругления для его углов. Для этого обратимся к документации по данной компоненте и обратим внимание 
на свойство [$panel-frame-border-radius](http://docs.sencha.com/extjs/5.1.3/api/Ext.MessageBox.html#css_var-S-$panel-frame-border-radius).
Для переопределения радиуса нам необходимо изменить значение переменной с 4px по умолчанию на своё значение, и сделать это нам нужно в файле нашей новой темы.
Перед началом работы с файлами хочу обратить внимание, что все файлы и пути в директориях var и src должны однозначно сопоставляться с именами и путями файлов приложения и фреймворка.
К примеру, для переопределения переменных класса `Ext.window.Window` мы создадим файл `Window.scss` в директории `var/window`. 
Если бы мы переопределяли класс `Ext.tab.Panel`, то нам бы потребовалось создать директорию `tab` внутри `var`, в которой должен будет находиться файл `Panel.scss`.

Вернемся к диалоговому окну. Создав файл `Window.scss` в директории `sass/var/window` пакета с нашей темой, приступим к его редактированию.  
Зададим в scss-нотации (очень похоже на css) интересующие нас свойства:
```sass
$panel-frame-border-radius: 14px !default
$window-border-radius: 14px !default
```
и дождемся, когда watch пересоберет нам стили. Обновляем страницу и смотрим результат:

![2](https://github.com/kos33rd/documentation/raw/0431b981d091dd2cf2aa83a2ffe941d799f0fcf8/extjs-styling/2.png)

Вернувшись к [основным переменным](http://docs.sencha.com/extjs/5.1.3/api/Global_CSS.html) попробуем задать глобально на всю тему основной цвет и базовый шрифт.
Для этого нам потребуется переопределить значение переменных у "корневого" класса Ext.Component. 
Создадим в директории `sass\var` файл Component.scss и добавим туда следующие строки:
 ```sass
 $base-color: red
 $font-family: 'Comic Sans MS', cursive
 ```

Результат не заставит себя долго ждать:

![3](https://github.com/kos33rd/documentation/raw/0431b981d091dd2cf2aa83a2ffe941d799f0fcf8/extjs-styling/3.png)

Как можно будет заметить, стиль был применен не только на окно, но и на все стандартные Ext JS-компоненты:

![4](https://github.com/kos33rd/documentation/raw/0431b981d091dd2cf2aa83a2ffe941d799f0fcf8/extjs-styling/4.png)

#### Альтернативный способ переопределения переменных темы
Если нам необходимо лишь слегка скорректировать тему, то нет необходимости генерировать для этого новую. 
Достаточно переопределить переменные основной темы из стилей нашего приложения. 
Для этих целей существует директория `sass/etc`, в которую мы можем поместить любые директивы, которые будут "подмешаны" в стили нашего приложения.
Создадим в этой папке два файла:

1. `corp_colors.scss` - файл с "корпоративными" цветами, котоыре должны будут использоваться в нашем приложении:
 ```sass
    $corp-color-dark-blue-color: #004077
    $corp-color-base-color: #0070BA
    
    $corp-color-light-blue-color: #2FB4E9
    $corp-color-black-color: #000000
    $corp-color-gray-color: #706F6F
    $corp-color-silver-color: #B2B2B2
    
    $corp-color-base-light-color: $corp-color-light-blue-color
 ```
 
2. `all.scss` - файл, переопределяющий глобальные переменные темы в нашем приложении:

```sass

    @import "corp_colors"
    
    $font-family: helvetica, arial, verdana, sans-serif !default
    $base-color: $corp-color-base-color !default
    $base-light-blue-color: #A5CCE6
    $base-light-color: corp-color-base-light-color !default
    $neutral-color: $base-light-blue-color !default
```

В файле `all.scss` мы подключили файл с цветами и переопределили ими [глобальные переменные](http://docs.sencha.com/extjs/5.1.3/api/Global_CSS.html) нашей темы.

Результат:

![9](https://github.com/kos33rd/documentation/raw/4fb08444370e5b37c2f1112798af8781a73c04a8/extjs-styling/9.png)

---

### Стилизация конкретных компонент
Предположим, что в нашем приложении есть много мест, где с помощью Ext.Window выдается различная информация. 
Но есть одно место, для которого охота сделать **особенное** вызывающе красное окошко.
В этом случае редактировать придется sass-стили самого приложения, а не тему.

Стили приложения расположены в директории sass, а структура файлов и папок абсолютно идентична пакету с темой. 
Отличие будет заключаться в том, что имена файлов и папок в директориях `var` и `src` теперь будут соответствовать классовой модели нашего приложения, а не фреймворка.
Допустим, окно, которое мы хотим стилизовать, расположено в директории `app/view/upload/Window` и объявляется классом 'MyApp.view.upload.Window'.

![5](https://github.com/kos33rd/documentation/raw/0431b981d091dd2cf2aa83a2ffe941d799f0fcf8/extjs-styling/5.png)

Sass-файл для него должен располагаться в директории `sass/src/view/upload` и называться `Window.scss`.
Для того, чтобы указать, что конкретно данное окно будет получать свои стили, нам для начала необходимо внести изменения в определение самого класса на JavaScript.
За привязку компоненты к стилю отвечает [директива ui](http://docs.sencha.com/extjs/5.1.3/api/Ext.window.Window.html#cfg-ui). Определим её в нашей view:
 ```javascript
 Ext.define('Fokus.view.upload.Window', {
     extend: 'Ext.window.Window',
     title: 'Импорт данных',
     ui: 'alert',  // <- вот это определение
     ...
 });
 ```

Теперь мы можем, привязавшись к данному стилю, переопределить стандартные стили темы для конкретно нашего окна в `sass/src/view/upload/Window.scss`:
```sass
@include extjs-window-ui(
  $ui: 'alert',
  $ui-border-color: red,
  $ui-body-background-color: red,
  $ui-header-background-color: red
)
```
Что здесь описано:

1. Мы расширили миксин класса Window `extjs-window-ui`
2. Который нашли по документации `Ext.window.Window` в секции [theme mixins](http://docs.sencha.com/extjs/5.1.3/api/Ext.window.Window.html#css_mixin-extjs-window-ui)
3. Описав дополнительный стиль `alert` через директиву `ui`
4. И переопределив для стиля переменные, отвечающие за цвет границ окна и его фона
5. Описание переменных мы нашли в той же документации по конкретному миксину [extjs-window-ui](http://docs.sencha.com/extjs/5.1.3/api/Ext.window.Window.html#css_mixin-extjs-window-ui)

Результатом является такое окно:

![6](https://github.com/kos33rd/documentation/raw/0431b981d091dd2cf2aa83a2ffe941d799f0fcf8/extjs-styling/6.png)

Для примера попробуем объявить еще несколько разных стилей для нашей компоненты в том же файле:

```sass
@include extjs-window-ui(
  $ui: 'warning',
  $ui-border-color: yellow,
  $ui-body-background-color: yellow,
  $ui-header-background-color: yellow
)

@include extjs-window-ui(
  $ui: 'ok',
  $ui-border-color: green,
  $ui-body-background-color: green,
  $ui-header-background-color: green
)
```

С таким набором стилей мы можем в рамках нескольких объектов одного и того же класса использовать разное визуальное оформление:

```javascript
Ext.create('Fokus.view.upload.Window', {
    ui: 'warning'
 }).show();
```

Результат:

![7](https://github.com/kos33rd/documentation/raw/0431b981d091dd2cf2aa83a2ffe941d799f0fcf8/extjs-styling/7.png)

Разные стили можно использовать одновременно на одной странице, а так же менять их у компоненты на лету:

![8](https://github.com/kos33rd/documentation/raw/0431b981d091dd2cf2aa83a2ffe941d799f0fcf8/extjs-styling/8.png)

---

### Стилизация собственных компонент

В этом разделе я бы с удовольствием поделился знаниями о том, как можно стилизовать свои компоненты, 
однако я сам только в общих чертах представляю механизм работы. 
 
 Поэтому, `TODO: описать стилизацию собственных компонент`.
